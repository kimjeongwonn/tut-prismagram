# Migration `20200826130616-2nd`

This migration has been generated by kimjeongwonn at 8/26/2020, 1:06:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `prismagram`.`Room` (
`id` int  NOT NULL  AUTO_INCREMENT,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `prismagram`.`Message` (
`id` int  NOT NULL  AUTO_INCREMENT,
`text` varchar(191)  NOT NULL ,
`fromUserId` int  NOT NULL ,
`toUserId` int  NOT NULL ,
`roomId` int  NOT NULL ,
`timestamp` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `prismagram`.`_RoomToUser` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE Index `_RoomToUser_AB_unique`(`A`,
`B`),
Index `_RoomToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `prismagram`.`Message` ADD FOREIGN KEY (`fromUserId`) REFERENCES `prismagram`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prismagram`.`Message` ADD FOREIGN KEY (`toUserId`) REFERENCES `prismagram`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prismagram`.`Message` ADD FOREIGN KEY (`roomId`) REFERENCES `prismagram`.`Room`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prismagram`.`_RoomToUser` ADD FOREIGN KEY (`A`) REFERENCES `prismagram`.`Room`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `prismagram`.`_RoomToUser` ADD FOREIGN KEY (`B`) REFERENCES `prismagram`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200825075430-first..20200826130616-2nd
--- datamodel.dml
+++ datamodel.dml
@@ -2,27 +2,30 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id        Int       @default(autoincrement()) @id
-  username  String    @unique
-  email     String    @unique
-  firstname String?
-  lastName  String?
-  bio       String?
-  followers User[]    @relation("FollowRelation")
-  following User[]    @relation("FollowRelation")
-  posts     Post[]
-  likes     Like[]
-  comments  Comment[]
+  id              Int       @default(autoincrement()) @id
+  username        String    @unique
+  email           String    @unique
+  firstname       String?
+  lastName        String?
+  bio             String?
+  followers       User[]    @relation("FollowRelation", references: [id])
+  following       User[]    @relation("FollowRelation", references: [id])
+  posts           Post[]
+  likes           Like[]
+  comments        Comment[]
+  room            Room[]
+  sendmessages    Message[] @relation("ToUser")
+  receivemessages Message[] @relation("FromUser")
 }
 model Post {
   id       Int     @default(autoincrement()) @id
@@ -57,4 +60,22 @@
   url    String
   post   Post   @relation(fields: [postId], references: [id])
   postId Int
 }
+
+model Room {
+  id          Int       @default(autoincrement()) @id
+  participant User[]
+  massages    Message[]
+}
+
+model Message {
+  id         Int      @default(autoincrement()) @id
+  text       String
+  fromUser   User     @relation("FromUser", fields: [fromUserId], references: [id])
+  fromUserId Int
+  toUser     User     @relation("ToUser", fields: [toUserId], references: [id])
+  toUserId   Int
+  room       Room     @relation(fields: [roomId], references: [id])
+  roomId     Int
+  timestamp  DateTime @default(now())
+}
```


